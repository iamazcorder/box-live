<template>
  <div class="rank-container">
    <!-- ÊäòÂè†Áä∂ÊÄÅ -->
    <div
      v-if="!expanded"
      class="collapsed-rank"
    >
      <div class="top3-list">
        <div
          v-for="(item, index) in fakeRankList.slice(0, 3)"
          :key="item.value?.user_id"
          class="rank-item"
        >
          <img
            :src="item.value.user_avatar"
            class="avatar"
          />
          <div class="right">
            <div class="rank-badge">Ê¶ú{{ index + 1 }}</div>
            <div class="username">{{ item.value.user_username }}</div>
          </div>
        </div>
      </div>
      <div
        class="toggle-btn"
        @click="toggleExpanded"
      >
        <div class="ico downArrow"></div>
      </div>
    </div>

    <!-- Â±ïÂºÄÁä∂ÊÄÅ -->
    <div
      v-else
      class="expanded-rank"
    >
      <!-- Tab Â§¥ÈÉ® -->
      <div class="tab-header">
        <span
          v-for="tab in tabs"
          :key="tab.value"
          :class="['tab-item', { active: currentTab === tab.value }]"
          @click="changeTab(tab.value)"
        >
          {{ tab.label }}
        </span>
      </div>

      <!-- üî• ‰∏çÂêåTabÁöÑ "operate" ÂÜÖÂÆπ -->
      <div class="operate">
        <div class="tip-desc">
          {{ currentOperate.tipText }}
          <div
            class="ico tip"
            @click="toggleModal"
          ></div>
        </div>
        <div class="switch">
          {{ currentOperate.switchText }}
          <div class="ico switch"></div>
        </div>
      </div>

      <!-- ÊéíË°åÊ¶úÂàóË°® -->
      <div class="rank-list">
        <div
          v-for="(item, index) in fakeRankList"
          :key="item.value?.user_id"
          class="rank-list-item"
        >
          <div class="rank-list-item-info">
            <span class="rank-number">
              <span
                v-if="index < 3"
                class="rank-number-top3"
                >{{ `Ê¶ú${index + 1}` }}</span
              >
              <span v-else>{{ index + 1 }}</span>
            </span>
            <img
              :src="item.value?.user_avatar"
              class="avatar"
            />
            <span class="username">{{ item.value?.user_username }}</span>
          </div>
          <span class="contribution">{{ item.value?.score }}</span>
        </div>
      </div>

      <!-- ÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ -->
      <div class="current-user">
        <div class="rank-number">-</div>
        <img
          :src="currentUser.value?.user_avatar"
          class="avatar"
        />
        <div class="contribution">
          <div style="margin-left: -5px; margin-bottom: 3px">
            Ë¥°ÁåÆÂÄºÔºö{{ currentUser.value?.score }}
          </div>
          <div>Âø´Êù•ÊäïÂñÇÂêßÔΩû</div>
        </div>
      </div>

      <!-- ÊäòÂè†ÊåâÈíÆ -->
      <div
        class="toggle-btn"
        @click="toggleExpanded"
      >
        <div class="ico upArrow"></div>
      </div>

      <!-- üî• ÂºπÁ™óÔºà‰∏çÂêå Tab ‰∏ãÂÜÖÂÆπ‰∏çÂêåÔºâ -->
      <div
        v-if="showModal"
        class="modal-overlay"
      >
        <div class="modal">
          <div class="modal-header">
            <span>{{ currentOperate.modalTitle }}</span>
            <button
              class="close-btn"
              @click="toggleModal"
            >
              √ó
            </button>
          </div>
          <div class="modal-content">
            <div
              v-for="(section, index) in currentOperate.modalContent"
              :key="index"
            >
              <div class="title">{{ section.title }}</div>
              <div
                v-for="text in section.texts"
                :key="text"
                class="text"
              >
                {{ text }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script lang="ts" setup>
import { computed, ref } from 'vue';

const expanded = ref(false);
const showModal = ref(false);
const currentTab = ref('online');

// Tab ÈÖçÁΩÆ
const tabs = [
  { label: 'Âú®Á∫øÊ¶ú', value: 'online' },
  { label: 'Êó•Ê¶ú', value: 'daily' },
  { label: 'Âë®Ê¶ú', value: 'weekly' },
  { label: 'ÊúàÊ¶ú', value: 'monthly' },
];

const fakeRankList = [
  {
    created_at: 1741276642463,
    client_ip: '',
    value: {
      live_room_id: 14,
      live_room_name: '',
      user_id: 11,
      user_username: 'Êù∞ÂÖãÂ∞èÂÖî',
      user_avatar:
        'https://i1.hdslb.com/bfs/face/72fafe063819f7ebc77d37353c8aa12e085e488b.jpg',
      score: '32',
    },
  },
  {
    created_at: 1741276642463,
    client_ip: '',
    value: {
      live_room_id: 21,
      live_room_name: '',
      user_id: 18,
      user_username: 'Á¶èÊ∞îÂ∞èÊü¥',
      user_avatar:
        'https://i0.hdslb.com/bfs/face/292443231d7adfdcffdede646b9f6ede0bdb16ac.jpg',
      score: '20',
    },
  },
  {
    created_at: 1741276642463,
    client_ip: '',
    value: {
      live_room_id: 19,
      live_room_name: '',
      user_id: 18,
      user_username: 'zxyy',
      user_avatar: 'http://localhost:8080/img/avatar4.webp',
      score: '12',
    },
  },
  {
    created_at: 1741276642463,
    client_ip: '',
    value: {
      live_room_id: 14,
      live_room_name: '',
      user_id: 18,
      user_username: 'zxj',
      user_avatar: 'http://localhost:8080/img/cover1.jpg',
      score: '5',
    },
  },
];
const currentUser = {
  created_at: 1741276642463,
  client_ip: '',
  value: {
    live_room_id: 14,
    live_room_name: '',
    user_id: 18,
    user_username: 'zxj',
    user_avatar: 'http://localhost:8080/img/cover1.jpg',
    score: '3',
  },
};

// **Âä®ÊÄÅÊìç‰ΩúÂÜÖÂÆπÔºà‰∏çÂêå Tab ÊòæÁ§∫‰∏çÂêåÊñáÊ°àÔºâ**
const operateContents = {
  online: {
    tipText: 'ÊäïÂñÇ„ÄÅÂèëÂºπÂπïÂùáÂèØËé∑ÂæóË¥°ÁåÆÂÄº',
    switchText: 'Ë¥°ÁåÆÂÄº',
    modalTitle: 'Âú®Á∫øÊ¶úÂçïËØ¥Êòé',
    modalContent: [
      {
        title: '‰∏Ä„ÄÅÊéíÂ∫èËßÑÂàô',
        texts: [
          '1„ÄÅÊ†πÊçÆ‰∏ªÊí≠Êú¨Âú∫Áõ¥Êí≠Âú®Á∫øÁî®Êà∑ÁöÑË¥°ÁåÆÂÄºÁî±È´òËá≥‰ΩéÊéíÂ∫è„ÄÇ',
          '2ËßÇ‰ºóÁÇπËµû30Ê¨°/ÂèëÂºπÂπï10Êù°/ËßÇÁúã15ÂàÜ/ÈÄÅÂá∫1ÁîµÊ±†Á§ºÁâ©ÔºåÂùáÊúâÊú∫‰ºöËé∑Âæó1ÁÇπÊ¶úÂçïË¥°ÁåÆÂÄº„ÄÇ',
        ],
      },
      {
        title: '‰∫å„ÄÅÁâπÂà´ÊèêÈÜí',
        texts: [
          'Ê≠§ÂàóË°®‰ªÖÂ±ïÁ§∫ÂΩìÂâçÂú®Áõ¥Êí≠Èó¥ÂÜÖÁî®Êà∑‰∫íÂä®ÊÉÖÂÜµÔºåËã•Á¶ªÂºÄÁõ¥Êí≠Èó¥ÊàñÈÄÄÂá∫ÈáçËøõÂêéÔºåÂàóË°®‰ø°ÊÅØ‰ºöÂèëÁîüÂèòÂåñËØ∑ÁÇπÂáªÊâìÂºÄÂú®Á∫øËßÇ‰ºóÂàóË°®‰∫ÜËß£ÂΩìÂâçÊéíÂêç„ÄÇ',
        ],
      },
    ],
  },
  daily: {
    tipText: 'ÊØèÊó•Ê¶úÂçïÂü∫‰∫éÁî®Êà∑Ë¥°ÁåÆ',
    switchText: 'Êò®Êó•Ë¥°ÁåÆÂÄº',
    modalTitle: 'Ë¥°ÁåÆÊ¶úËØ¥Êòé',
    modalContent: [
      {
        title: '‰∏Ä„ÄÅÊ¶úÂçïËßÑÂàô',
        texts: ['1„ÄÅÁªüËÆ°Êò®Êó• 00:00 - 23:59 Ë¥°ÁåÆÂÄº', '2„ÄÅÊ¶úÂçïÊ¨°Êó•00:00Âà∑Êñ∞'],
      },
      { title: '‰∫å„ÄÅÂ•ñÂä±ËßÑÂàô', texts: ['ÊØèÊó•Ê¶úÂâç3ÂêçÂ∞ÜËé∑ÂæóÁâπÊÆäÁß∞Âè∑'] },
    ],
  },
  weekly: {
    tipText: 'ÊØèÂë®Ê¶úÂçïÁªüËÆ°Êï¥Âë®Ë¥°ÁåÆÂÄº',
    switchText: 'Êú¨Âë®Ë¥°ÁåÆÂÄº',
    modalTitle: 'Âë®Ê¶úËØ¥Êòé',
    modalContent: [
      {
        title: '‰∏Ä„ÄÅÊ¶úÂçïËßÑÂàô',
        texts: ['1„ÄÅÁªüËÆ°Êú¨Âë®‰∏Ä 00:00 Ëá≥ÂΩìÂâçË¥°ÁåÆÂÄº', '2„ÄÅÊ¶úÂçïÊØèÂë®‰∏Ä00:00Âà∑Êñ∞'],
      },
      { title: '‰∫å„ÄÅÂ•ñÂä±ËßÑÂàô', texts: ['Âë®Ê¶úÂâç5ÂêçÂ∞ÜËé∑ÂæóÁâπÂà´Â•ñÂä±'] },
    ],
  },
  monthly: {
    tipText: 'ÊØèÊúàÊ¶úÂçïÁªüËÆ°Êï¥ÊúàË¥°ÁåÆÂÄº',
    switchText: 'Êú¨ÊúàË¥°ÁåÆÂÄº',
    modalTitle: 'ÊúàÊ¶úËØ¥Êòé',
    modalContent: [
      {
        title: '‰∏Ä„ÄÅÊ¶úÂçïËßÑÂàô',
        texts: ['1„ÄÅÁªüËÆ°Êú¨Êúà1Âè∑ 00:00 Ëá≥ÂΩìÂâçË¥°ÁåÆÂÄº', '2„ÄÅÊ¶úÂçïÊØèÊúà1Âè∑00:00Âà∑Êñ∞'],
      },
      { title: '‰∫å„ÄÅÂ•ñÂä±ËßÑÂàô', texts: ['ÊúàÊ¶úÂâç10ÂêçÂèØËé∑Âæó‰∏ìÂ±ûÁâπÊïà'] },
    ],
  },
};

// **Ê†πÊçÆÂΩìÂâç Tab Ëé∑Âèñ‰∏çÂêåÂÜÖÂÆπ**
const currentOperate = computed(() => operateContents[currentTab.value]);

// ÂàáÊç¢ Tab
const changeTab = (tab: string) => {
  currentTab.value = tab;
};

// ÂàáÊç¢ÂºπÁ™ó
const toggleModal = () => {
  showModal.value = !showModal.value;
};

// Â±ïÂºÄ/ÊäòÂè†ÊéíË°åÊ¶ú
const toggleExpanded = () => {
  expanded.value = !expanded.value;
};
</script>
<style lang="scss" scoped>
.ico {
  width: 15px;
  height: 15px;
  opacity: 0.9;

  &.upArrow {
    @include setBackground('@/assets/img/upArrow.png');
  }

  &.downArrow {
    @include setBackground('@/assets/img/downArrow.png');
  }

  &.tip {
    width: 14px;
    height: 14px;
    cursor: pointer;
    margin-left: 3px;
    @include setBackground('@/assets/img/tip.png');
  }

  &.switch {
    width: 14px;
    height: 14px;
    cursor: pointer;
    margin-left: 3px;
    @include setBackground('@/assets/img/switch-nowrap.png');
  }
}

.rank-container {
  width: 100%;
  /* max-width: 245px; */
  box-sizing: border-box;
  text-align: center;
  background: #fff;
  padding: 5px 0 10px 0;
  /* border-radius: 10px; */
  /* box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); */
  position: absolute;
  z-index: 99999;
  left: 0;
  /* border: 1px solid red; */
  border-bottom: 1px solid #e3e5e7;
}

/* ÊäòÂè†Áä∂ÊÄÅ */
.collapsed-rank {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;

  .top3-list {
    display: flex;
    width: 100%;
    justify-content: space-between;
    box-sizing: border-box;
    padding: 0 15px;
  }
}

.rank-item {
  display: flex;
  align-items: center;

  .right {
    display: flex;
    flex-direction: column;
  }
}

.avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 10px;
  /* margin-top: 3px; */
}

.rank-badge {
  background: #ff7b7b;
  color: white;
  padding: 1px 5px;
  border-radius: 10px;
  font-size: 10px;
  margin-top: 5px;
  width: 25px;
}

.username {
  font-size: 12px;
  /* margin-top: 5px; */
  color: #2f3238;
  margin-left: -2px;
}

/* Â±ïÂºÄÁä∂ÊÄÅ */
.expanded-rank {
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Tab Ê†∑Âºè */
.tab-header {
  display: flex;
  justify-content: space-between;
  width: 100%;
  padding: 5px 10px;
  box-sizing: border-box;
}

.operate {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: #61666d;
  margin: 10px 0;
  padding: 0 10px;
  box-sizing: border-box;

  .tip-desc {
    display: flex;
    align-items: center;
  }

  .switch {
    display: flex;
    align-items: center;
  }
}

.tab-item {
  cursor: pointer;
  padding: 3px 18px;
  color: #61666d;
  border-radius: 34px;
  background-color: #dde2e6;
  font-size: 12px;
  opacity: 0.8;
}

.tab-item.active {
  color: #f69;
  font-weight: 600;
  opacity: 1;
  background-color: #fedee8;
}

/* ÊéíË°åÊ¶úÂàóË°® */
.rank-list {
  height: 150px;
  overflow-y: auto;
  width: 100%;
  padding: 0 8px 0 5px;
  box-sizing: border-box;
}

/* ËÆæÁΩÆÊªöÂä®Êù°ÂÆΩÂ∫¶ */
::-webkit-scrollbar {
  width: 6px;
  /* Á∫µÂêëÊªöÂä®Êù°ÁöÑÂÆΩÂ∫¶ */
}

/* ÊªöÂä®Êù°ÁöÑÊªëÂùó */
::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.3);
  /* ËÆæÁΩÆÊªöÂä®Êù°È¢úËâ≤ */
  border-radius: 4px;
  /* ÂúÜËßí */
}

.rank-list-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 0;

  &-info {
    display: flex;
    align-items: center;
  }
}

.rank-number {
  width: 44px;
  /* height: 16px; */
  line-height: 24px;
  text-align: center;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  font-size: 12px;
  font-weight: 700;
}

.rank-number-top3 {
  background: #ff7b7b;
  color: white;
  padding: 1px 5px;
  border-radius: 10px;
  font-size: 10px;
  margin-top: 5px;
}

.contribution {
  font-size: 12px;
  color: #61666d;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* ÂΩìÂâçÁî®Êà∑‰ø°ÊÅØ */
.current-user {
  width: 100%;
  text-align: center;
  height: 50px;
  color: #2f3238;
  border-top: 1px solid #e3e5e7;
  display: flex;
  align-items: center;
  padding-left: 5px;
  box-sizing: border-box;
  padding-top: 5px;
}

.current-user p {
  font-size: 12px;
  color: gray;
}

/* ÊåâÈíÆ */
.toggle-btn {
  border-radius: 16px;
  background: #eceff2;
  /* opacity: .2; */
  width: 44px;
  height: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 10px;
  cursor: pointer;
}

/* üî• üî• üî• Â±Ö‰∏≠ÂºπÁ™óÁöÑÊ†∑Âºè üî• üî• üî• */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.5);
  /* ÂçäÈÄèÊòéÈÅÆÁΩ© */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  /* Á°Æ‰øùÂºπÁ™óÂú®ÊúÄ‰∏äÂ±Ç */
}

.modal {
  background: white;
  width: 320px;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
  text-align: center;
}

/* ÂºπÁ™óÂ§¥ÈÉ® */
.modal-header {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
  color: #000000;
}

.close-btn {
  border: none;
  background: none;
  font-size: 20px;
  cursor: pointer;
}

/* ÂºπÁ™óÂÜÖÂÆπ */
.modal-content {
  font-size: 14px;
  color: #333;

  .title {
    color: #000000;
    font-size: 16px;
  }

  .text {
    color: #7e8c8d;
    font-size: 16px;
    margin: 10px 0;
  }

  div {
    text-align: left;
  }
}
</style>
